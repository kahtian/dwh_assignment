-- =============================================
-- SUPPLIER_DIM (SCD2)  â€” with FK on supplierID
-- =============================================
DROP TABLE supplier_dim CASCADE CONSTRAINTS;
DROP SEQUENCE supplier_dim_seq;

CREATE TABLE supplier_dim
(
    supplier_key         NUMBER       NOT NULL,         -- PK (surrogate)
    supplierID           VARCHAR2(5)  NOT NULL,         -- FK to OLTP SUPPLIER
    supplierName         VARCHAR2(100),
    supplierLocation     VARCHAR2(100),
    supplierContactNum   VARCHAR2(20),
    supplierEmail        VARCHAR2(100),
    effective_start_date DATE,
    effective_end_date   DATE,
    is_current_flag      CHAR(1),
    CONSTRAINT supplier_dim_pk PRIMARY KEY (supplier_key),
    CONSTRAINT supplier_dim_supplierid_fk
        FOREIGN KEY (supplierID) REFERENCES SUPPLIER (SUPPLIERID)
);

CREATE SEQUENCE supplier_dim_seq START WITH 1000 INCREMENT BY 1;

-- Initial load
INSERT INTO supplier_dim
SELECT supplier_dim_seq.NEXTVAL,
       s.SUPPLIERID,
       UPPER(s.SUPPLIERNAME),
       UPPER(s.SUPPLIERLOCATION),
       s.SUPPLIERCONTACTNUM,
       UPPER(s.SUPPLIEREMAIL),
       SYSDATE,
       DATE '9999-12-31',
       '1'
FROM SUPPLIER s;

COMMIT;
